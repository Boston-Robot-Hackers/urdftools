robot: linorobot2_2wd

# Robot type declaration (follows ROS REP 105 standards)
type: mobile_platform
  drive_type: differential
  wheels: 2
  casters: 2
  sensors:
    imu: 1
    lidar: 1
    depth_camera: 1
    sonar: 1

# Define reusable parameters
params:
  # Base platform dimensions
  base_length: 0.24
  base_width: 0.275
  base_height: 0.003
  base_mass: 1.0

  # Wheel properties
  wheel_radius: 0.045
  wheel_width: 0.01
  wheel_pos_x: 0.0
  wheel_pos_y: 0.13
  wheel_pos_z: -0.03
  wheel_mass: 0.1
  wheel_torque: 20

  # Caster wheel (calculated from wheel geometry)
  caster_radius: 0.0375  # (wheel_radius - wheel_pos_z) / 2
  caster_mass: 0.01

  # Sensor positions
  laser_pos: [0.12, 0, 0.33]
  camera_pos: [0.14, 0.0, 0.045]
  sonar_pos: [0.15, 0, 0]

# Hierarchy - defines the TF tree structure
hierarchy:
  base_footprint:
    - base_link:
        - left_wheel_link
        - right_wheel_link
        - front_caster_wheel_link
        - rear_caster_wheel_link
        - imu_link
        - laser
        - camera_link:
            - camera_depth_link
        - sonar_link

# Links - defines geometry, materials, and physics
links:
  # Root frame (ground projection)
  base_footprint:
    # Virtual link, no geometry

  # Main base platform
  base_link:
    origin: {xyz: [0, 0, {wheel_radius - wheel_pos_z}]}  # Relative to base_footprint
    box: {size: [{base_length}, {base_width}, {base_height}]}
    material: yellow
    mass: {base_mass}
    # Collision and inertia auto-generated from geometry + mass

  # Drive wheels (continuous joints)
  left_wheel_link:
    origin: {xyz: [{wheel_pos_x}, {wheel_pos_y}, {wheel_pos_z}], rpy: [90deg, 0, 0]}
    cylinder: {radius: {wheel_radius}, length: {wheel_width}}
    material: blue
    mass: {wheel_mass}
    joint_type: continuous
    axis: [0, 1, 0]

  right_wheel_link:
    origin: {xyz: [{wheel_pos_x}, {-wheel_pos_y}, {wheel_pos_z}], rpy: [90deg, 0, 0]}
    cylinder: {radius: {wheel_radius}, length: {wheel_width}}
    material: blue
    mass: {wheel_mass}
    joint_type: continuous
    axis: [0, 1, 0]

  # Caster wheels (passive, fixed joints with low friction)
  front_caster_wheel_link:
    origin: {xyz: [{base_length/2 - caster_radius}, 0, {-caster_radius}]}
    sphere: {radius: {caster_radius}}
    material: black
    mass: {caster_mass}
    # Joint type defaults to fixed

  rear_caster_wheel_link:
    origin: {xyz: [{-(base_length/2 - caster_radius)}, 0, {-caster_radius}]}
    sphere: {radius: {caster_radius}}
    material: black
    mass: {caster_mass}

  # IMU sensor (virtual link, no geometry)
  imu_link:
    # No geometry, just a coordinate frame at base_link origin

  # Lidar sensor
  laser:
    origin: {xyz: {laser_pos}}
    cylinder: {radius: 0.0375, length: 0.05}
    material: green
    mass: 0.1
    # Visual origin offset handled in Gazebo section

  # Depth camera
  camera_link:
    origin: {xyz: {camera_pos}}
    box: {size: [0.030, 0.124, 0.030]}
    material: red
    mass: 0.135

  # Camera depth optical frame (rotated coordinate frame for ROS convention)
  camera_depth_link:
    origin: {rpy: [-90deg, 0, -90deg]}
    # Virtual frame, no geometry

  # Sonar sensor (virtual link, no geometry)
  sonar_link:
    origin: {xyz: {sonar_pos}}
    # No geometry, just a coordinate frame

# Gazebo simulation configuration
gazebo:
  # Material properties (for simulation physics)
  materials:
    base_link:
      ambient: [0.8392, 0.6314, 0.0, 1.0]
      diffuse: [0.8392, 0.6314, 0.0, 1.0]
      specular: [0.99, 0.99, 0.99, 1.0]

    left_wheel_link:
      ambient: [0.1764, 0.4588, 0.8509, 1.0]
      diffuse: [0.1764, 0.4588, 0.8509, 1.0]
      specular: [0.1764, 0.4588, 0.8509, 1.0]

    right_wheel_link:
      ambient: [0.1764, 0.4588, 0.8509, 1.0]
      diffuse: [0.1764, 0.4588, 0.8509, 1.0]
      specular: [0.1764, 0.4588, 0.8509, 1.0]

    laser:
      ambient: [0.003, 0.639, 0.223, 1.0]
      diffuse: [0.003, 0.639, 0.223, 1.0]
      specular: [0.003, 0.639, 0.223, 1.0]

    camera_link:
      ambient: [0.416, 0.051, 0.047, 1.0]
      diffuse: [0.416, 0.051, 0.047, 1.0]
      specular: [0.416, 0.051, 0.047, 1.0]

  # Friction properties
  friction:
    front_caster_wheel_link: {mu1: 0.01, mu2: 0.01}
    rear_caster_wheel_link: {mu1: 0.01, mu2: 0.01}

  # Sensors
  sensors:
    imu:
      link: imu_link
      type: imu
      update_rate: 20
      plugin:
        name: imu_plugin
        filename: libgazebo_ros_imu_sensor.so
        topic: imu/data
        frame: imu_link
        gaussian_noise: 0.0

    lidar:
      link: laser
      type: gpu_ray
      update_rate: 10
      ray_count: 360
      angle_range: [-3.1416, 3.1416]
      range: [0.08, 12.0]
      plugin:
        name: laser_lidar_controller
        filename: libgazebo_ros_ray_sensor.so
        topic: scan
        frame: laser

    depth_camera:
      link: camera_link
      type: depth
      update_rate: 30.0
      horizontal_fov: 1.50098
      image: {width: 640, height: 480, format: R8G8B8}
      depth_range: [0.015, 3.0]
      plugin:
        name: camera_controller
        filename: libgazebo_ros_camera.so
        frame: camera_depth_link
        topics:
          camera_info: /camera/color/camera_info
          image_raw: /camera/color/image_raw
          points: /camera/depth/color/points
          depth_image: /camera/depth/image_rect_raw

  # Controller
  controller:
    type: differential_drive
    plugin:
      name: differential_drive_controller
      filename: libgazebo_ros_diff_drive.so
      update_rate: 100
      left_joint: left_wheel_joint
      right_joint: right_wheel_joint
      wheel_separation: {wheel_pos_y * 2}
      wheel_diameter: {wheel_radius * 2}
      max_wheel_acceleration: 1.0
      robot_base_frame: base_footprint
      odometry_frame: odom
      publish_odom: true
      publish_odom_tf: false
      publish_wheel_tf: true
      topics:
        odom: odom/unfiltered

# ==============================================================================
# NOTES ON DSL FEATURES DEMONSTRATED
# ==============================================================================
#
# 1. FLAT SYNTAX - Geometry types as top-level fields:
#    - cylinder: {radius, length}
#    - box: {size: [x, y, z]}
#    - sphere: {radius}
#    Instead of nested visual/geometry/type structure
#
# 2. SEPARATE HIERARCHY - TF tree visible at a glance
#    Hierarchy defines parent-child relationships
#    Links define properties (geometry, mass, materials)
#
# 3. SMART DEFAULTS:
#    - Collision geometry = visual geometry (unless overridden)
#    - Inertia auto-calculated from geometry + mass (unless overridden)
#    - Origin = [0,0,0] when omitted
#    - Joint type = fixed when omitted
#
# 4. MATERIAL LIBRARY - Named colors (yellow, blue, black, green, red)
#    Instead of RGBA definitions everywhere
#
# 5. VARIABLE SUBSTITUTION - {param} with arithmetic
#    Example: {base_length/2 - caster_radius}
#
# 6. ROBOT TYPE DECLARATION - Enables validation
#    Checks wheel count, required frames, sensor inventory
#
# 7. GAZEBO SECTION - Simulation config separate from robot structure
#    Materials, friction, sensors, controllers all in one place
#
# COMPARISON TO ORIGINAL URDF XACRO:
# Original: ~500+ lines across 10+ files
# DSL:      ~200 lines in 1 self-contained file
# Reduction: 60% fewer lines, 100% self-contained
#
# ==============================================================================
